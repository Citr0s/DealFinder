<mat-card>
    <h1>Nearby Deals</h1>
    <mat-tab-group (selectedTabChange)="resizeMap($event)">
        <mat-tab label="List View">
            <div class="spacer"></div>
            <div class="spinner-wrapper">
                <mat-spinner *ngIf="dealsModel.deals.length === 0 && dealsModel.feedback.length === 0"></mat-spinner>
            </div>
            {{ dealsModel.feedback }}
            <mat-card class="deal-card" *ngFor="let deal of dealsModel.deals">
                <div class="row">
                    <div class="col-sm-6">
                        <h2 class="title">{{ deal.title }}</h2>
                        <h6 class="distance">
                            <span class="grey">{{ deal.distanceDescription }}</span>
                            <div style="font-weight:normal;">
                                Score: <span style="font-weight:bold;">{{ deal.votes.finalScore }}</span> out of
                                <span style="font-weight:bold;">{{ deal.votes.totalVotes }}</span> votes.
                            </div>
                            <div *ngIf="user && !deal.votes.hasAlreadyVoted">
                                <span class="clickable plus" (click)="voteUp(deal)">+</span>
                                vote
                                <span class="clickable minus" (click)="voteDown(deal)">-</span>
                            </div>
                        </h6>

                    </div>
                    <div class="col-sm-6">
                        <div class="user">
                            <h5>{{ deal.user.username }}</h5>
                            <img src="{{ deal.user.picture }}"/>
                        </div>
                    </div>
                </div>
                <div class="summary">{{ deal.summary }}</div>
            </mat-card>
        </mat-tab>
        <mat-tab label="Map View">
            <div class="spacer"></div>
            <agm-map #map class="map" [latitude]="currentCoordinates.latitude"
                     [longitude]="currentCoordinates.longitude"
                     [zoom]="15"
                     [streetViewControl]="false"
                     [mapTypeControl]="true" [fullscreenControl]="false">
                <agm-marker *ngFor="let deal of dealsModel.deals" [latitude]="deal.location.latitude"
                            [longitude]="deal.location.longitude"
                            [iconUrl]="'assets/deal-pin.png'" (markerClick)="viewDealDetails(deal)"></agm-marker>
                <agm-marker [latitude]="currentCoordinates.latitude"
                            [longitude]="currentCoordinates.longitude"
                            [iconUrl]="'assets/pin.png'" (markerClick)="viewYouAreHere()"></agm-marker>
            </agm-map>
        </mat-tab>
    </mat-tab-group>
    <div class="alert" *ngIf="dealsModel.hasError">{{ dealsModel.error }}</div>
</mat-card>